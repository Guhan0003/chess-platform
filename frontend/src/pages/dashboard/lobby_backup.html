<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lobby - Chess Platform</title>
  <link rel="stylesheet" href="../../styles/global.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* Lobby-specific styles maintaining design consistency */
    .lobby-container {
      display: flex;
      min-height: 100vh;
      background: linear-gradient(135deg, var(--color-bg-primary) 0%, var(--color-bg-secondary) 100%);
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="lobby-container">
      <!-- Sidebar Navigation -->
      <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <h1 class="sidebar-logo">Chess Platform</h1>
          <p class="sidebar-subtitle">Professional Chess</p>
        </div>
        
        <div class="sidebar-nav">
          <div class="nav-section">
            <div class="nav-section-title">Play</div>
            <div class="nav-items">
              <a href="#" class="nav-item active" data-route="/lobby">
                <span class="nav-icon">üè†</span>
                <span>Lobby</span>
              </a>
              <a href="#" class="nav-item" data-route="/game/new">
                <span class="nav-icon">‚ö°</span>
                <span>Quick Play</span>
              </a>
              <a href="#" class="nav-item" data-route="/puzzles">
                <span class="nav-icon">üß©</span>
                <span>Puzzles</span>
              </a>
            </div>
          </div>
          
          <div class="nav-section">
            <div class="nav-section-title">Account</div>
            <div class="nav-items">
              <a href="#" class="nav-item" data-route="/profile">
                <span class="nav-icon">üë§</span>
                <span>Profile</span>
              </a>
              <a href="#" class="nav-item" data-route="/settings">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span>Settings</span>
              </a>
              <a href="#" class="nav-item" id="logout-btn">
                <span class="nav-icon">üö™</span>
                <span>Logout</span>
              </a>
            </div>
          </div>
        </div>
        
        <div class="sidebar-footer">
          <div class="user-profile" data-route="/profile">
            <div class="user-avatar" id="userAvatar">?</div>
            <div class="user-info">
              <div class="user-name" id="userName">Loading...</div>
              <div class="user-rating">
                Rating: <span class="rating-badge" id="userRating">----</span>
              </div>
            </div>
          </div>
        </div>
      </nav>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Header -->
        <header class="header">
          <div class="header-title">Chess Lobby</div>
          <div class="header-actions">
            <div class="status-indicator">
              <div class="status-dot"></div>
              <span>Online</span>
            </div>
          </div>
        </header>

        <!-- Content Area -->
        <div class="content">
          <div class="content-main">
            <!-- Quick Actions -->
            <section class="quick-actions glass-card">
              <h2 class="section-title">
                <span class="section-icon">‚ö°</span>
                Quick Actions
              </h2>
              
              <div class="action-grid">
                <div class="action-card quick-play" id="quickPlayBtn">
                  <span class="action-icon">‚ö°</span>
                  <h3 class="action-title">Quick Play</h3>
                  <p class="action-description">Get matched with a player of similar rating instantly</p>
                </div>
                
                <div class="action-card create-game" id="createGameBtn">
                  <span class="action-icon">‚ûï</span>
                  <h3 class="action-title">Create Game</h3>
                  <p class="action-description">Set up a custom game and wait for opponents</p>
                </div>
                
                <div class="action-card join-game" id="joinGameBtn">
                  <span class="action-icon">üîç</span>
                  <h3 class="action-title">Browse Games</h3>
                  <p class="action-description">Join existing games or spectate ongoing matches</p>
                </div>
                
                <div class="action-card puzzles" data-route="/puzzles">
                  <span class="action-icon">üß©</span>
                  <h3 class="action-title">Solve Puzzles</h3>
                  <p class="action-description">Improve your tactical skills with chess puzzles</p>
                </div>
              </div>
            </section>

            <!-- Active Games -->
            <section class="games-section glass-card">
              <h2 class="section-title">
                <span class="section-icon">‚ôüÔ∏è</span>
                Active Games
              </h2>
              
              <div class="games-list" id="gamesList">
                <!-- Games will be loaded here -->
                <div class="loading-skeleton"></div>
                <div class="loading-skeleton"></div>
                <div class="loading-skeleton"></div>
              </div>
            </section>
          </div>

          <div class="content-sidebar">
            <!-- User Statistics -->
            <div class="stats-panel">
              <h3 class="section-title">
                <span class="section-icon">üìä</span>
                Your Stats
              </h3>
              
              <div class="stats-grid">
                <div class="stat-item">
                  <div class="stat-value" id="gamesPlayed">--</div>
                  <div class="stat-label">Games Played</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value" id="winRate">--%</div>
                  <div class="stat-label">Win Rate</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value" id="currentStreak">--</div>
                  <div class="stat-label">Win Streak</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value" id="bestRating">----</div>
                  <div class="stat-label">Best Rating</div>
                </div>
              </div>
            </div>

            <!-- Online Players -->
            <div class="online-players">
              <h3 class="section-title">
                <span class="section-icon">üü¢</span>
                Online Players
              </h3>
              
              <div class="players-list" id="onlinePlayersList">
                <!-- Online players will be loaded here -->
                <div class="empty-state">
                  <div class="empty-icon">üë•</div>
                  <div class="empty-title">Loading players...</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <script>
    // Lobby page controller
    function initLobbyPage() {
      let currentUser = null;
      let games = [];
      let onlinePlayers = [];
      
      // Initialize lobby
      initializeLobby();
      
      async function initializeLobby() {
        try {
          // Load user profile
          await loadUserProfile();
          
          // Load games list
          await loadGames();
          
          // Load online players (mock for now)
          loadOnlinePlayers();
          
          // Set up event listeners
          setupEventListeners();
          
          // Set up periodic updates
          setupPeriodicUpdates();
          
        } catch (error) {
          console.error('Failed to initialize lobby:', error);
          api.showError('Failed to load lobby data');
        }
      }
      
      async function loadUserProfile() {
        try {
          const response = await api.getUserProfile();
          if (response.ok) {
            currentUser = response.data;
            updateUserDisplay();
          }
        } catch (error) {
          console.error('Failed to load user profile:', error);
          // Use fallback data
          currentUser = {
            username: 'Player',
            rating: 1200,
            games_played: 0,
            games_won: 0
          };
          updateUserDisplay();
        }
      }
      
      function updateUserDisplay() {
        const userNameEl = document.getElementById('userName');
        const userRatingEl = document.getElementById('userRating');
        const userAvatarEl = document.getElementById('userAvatar');
        
        if (currentUser) {
          userNameEl.textContent = currentUser.username;
          userRatingEl.textContent = currentUser.rating || 1200;
          userAvatarEl.textContent = currentUser.username.charAt(0).toUpperCase();
          
          // Update stats
          document.getElementById('gamesPlayed').textContent = currentUser.games_played || 0;
          const winRate = currentUser.games_played > 0 
            ? Math.round((currentUser.games_won / currentUser.games_played) * 100)
            : 0;
          document.getElementById('winRate').textContent = winRate;
          document.getElementById('currentStreak').textContent = currentUser.current_streak || 0;
          document.getElementById('bestRating').textContent = currentUser.best_rating || currentUser.rating || 1200;
        }
      }
      
      async function loadGames() {
        try {
          const response = await api.getGames();
          if (response.ok) {
            games = response.data;
            updateGamesDisplay();
          }
        } catch (error) {
          console.error('Failed to load games:', error);
          showEmptyGames();
        }
      }
      
      function updateGamesDisplay() {
        const gamesListEl = document.getElementById('gamesList');
        
        if (!games || games.length === 0) {
          showEmptyGames();
          return;
        }
        
        gamesListEl.innerHTML = games.map(game => `
          <div class="game-card" data-game-id="${game.id}">
            <div class="game-players">
              <div class="player-info">
                <div class="player-avatar">${game.white_player_username.charAt(0).toUpperCase()}</div>
                <div>
                  <div class="player-name">${game.white_player_username}</div>
                  <div class="player-rating">${game.white_player_rating || 1200}</div>
                </div>
              </div>
              
              <div class="vs-divider">vs</div>
              
              <div class="player-info">
                <div class="player-avatar">${game.black_player_username ? game.black_player_username.charAt(0).toUpperCase() : '?'}</div>
                <div>
                  <div class="player-name">${game.black_player_username || 'Waiting...'}</div>
                  <div class="player-rating">${game.black_player_rating || '----'}</div>
                </div>
              </div>
            </div>
            
            <div class="game-status">
              <div class="status-badge status-${game.status}">${getStatusText(game.status)}</div>
              <div class="game-time">${getTimeAgo(game.created_at)}</div>
            </div>
          </div>
        `).join('');
        
        // Add click handlers to game cards
        document.querySelectorAll('.game-card').forEach(card => {
          card.addEventListener('click', () => {
            const gameId = card.dataset.gameId;
            router.navigate(`/game/${gameId}`);
          });
        });
      }
      
      function showEmptyGames() {
        const gamesListEl = document.getElementById('gamesList');
        gamesListEl.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">‚ôüÔ∏è</div>
            <div class="empty-title">No Active Games</div>
            <div class="empty-description">Create a new game or browse available games to get started!</div>
          </div>
        `;
      }
      
      function loadOnlinePlayers() {
        // Mock online players for now
        onlinePlayers = [
          { username: 'ChessMaster', rating: 1650, status: 'online' },
          { username: 'KnightRider', rating: 1420, status: 'playing' },
          { username: 'QueenGambit', rating: 1580, status: 'online' },
          { username: 'PawnStorm', rating: 1350, status: 'online' },
          { username: 'CastleKing', rating: 1720, status: 'playing' }
        ];
        
        updateOnlinePlayersDisplay();
      }
      
      function updateOnlinePlayersDisplay() {
        const playersListEl = document.getElementById('onlinePlayersList');
        
        if (!onlinePlayers || onlinePlayers.length === 0) {
          playersListEl.innerHTML = `
            <div class="empty-state">
              <div class="empty-icon">üë•</div>
              <div class="empty-title">No players online</div>
            </div>
          `;
          return;
        }
        
        playersListEl.innerHTML = onlinePlayers.map(player => `
          <div class="player-item" data-username="${player.username}">
            <div class="player-status"></div>
            <div class="player-avatar">${player.username.charAt(0).toUpperCase()}</div>
            <div class="player-info">
              <div class="player-name">${player.username}</div>
              <div class="player-rating">${player.rating}</div>
            </div>
          </div>
        `).join('');
      }
      
      function setupEventListeners() {
        // Quick Play
        document.getElementById('quickPlayBtn').addEventListener('click', async () => {
          api.showToast('Quick Play feature coming soon!', 'info');
        });
        
        // Create Game
        document.getElementById('createGameBtn').addEventListener('click', async () => {
          try {
            const response = await api.createGame();
            if (response.ok) {
              api.showSuccess('Game created successfully!');
              router.navigate(`/game/${response.data.id}`);
            } else {
              api.showError(api.formatError(response));
            }
          } catch (error) {
            api.showError('Failed to create game');
          }
        });
        
        // Browse Games
        document.getElementById('joinGameBtn').addEventListener('click', () => {
          // Scroll to games section
          document.querySelector('.games-section').scrollIntoView({ 
            behavior: 'smooth' 
          });
        });
        
        // Logout
        document.getElementById('logout-btn').addEventListener('click', async () => {
          if (confirm('Are you sure you want to logout?')) {
            await api.logout();
          }
        });
        
        // Navigation items
        document.querySelectorAll('.nav-item[data-route]').forEach(item => {
          item.addEventListener('click', (e) => {
            e.preventDefault();
            const route = item.dataset.route;
            router.navigate(route);
          });
        });
        
        // User profile click
        document.querySelector('.user-profile[data-route]').addEventListener('click', () => {
          router.navigate('/profile');
        });
      }
      
      function setupPeriodicUpdates() {
        // Refresh games list every 30 seconds
        setInterval(() => {
          loadGames();
        }, 30000);
        
        // Refresh online players every 60 seconds
        setInterval(() => {
          loadOnlinePlayers();
        }, 60000);
      }
      
      // Utility functions
      function getStatusText(status) {
        const statusMap = {
          waiting: 'Waiting',
          active: 'Active',
          finished: 'Finished'
        };
        return statusMap[status] || status;
      }
      
      function getTimeAgo(dateString) {
        const now = new Date();
        const date = new Date(dateString);
        const diffInMs = now - date;
        const diffInMins = Math.floor(diffInMs / 60000);
        
        if (diffInMins < 1) return 'Just now';
        if (diffInMins < 60) return `${diffInMins}m ago`;
        
        const diffInHours = Math.floor(diffInMins / 60);
        if (diffInHours < 24) return `${diffInHours}h ago`;
        
        const diffInDays = Math.floor(diffInHours / 24);
        return `${diffInDays}d ago`;
      }
    }

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initLobbyPage);
    } else {
      initLobbyPage();
    }
  </script>
</body>
</html>

    /* Sidebar Navigation */
    .sidebar {
      width: var(--sidebar-width);
      background: var(--glass-bg);
      backdrop-filter: blur(16px);
      border-right: 1px solid var(--glass-border);
      display: flex;
      flex-direction: column;
      position: fixed;
      height: 100vh;
      left: 0;
      top: 0;
      z-index: 100;
      overflow-y: auto;
    }

    .sidebar-header {
      padding: var(--space-xl) var(--space-lg);
      border-bottom: 1px solid var(--glass-border);
    }

    .sidebar-logo {
      font-size: var(--font-size-xl);
      font-weight: var(--font-weight-bold);
      background: linear-gradient(135deg, var(--color-accent-primary) 0%, var(--color-accent-light) 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: var(--space-xs);
    }

    .sidebar-subtitle {
      font-size: var(--font-size-xs);
      color: var(--color-text-muted);
    }

    .sidebar-nav {
      flex: 1;
      padding: var(--space-lg);
    }

    .nav-section {
      margin-bottom: var(--space-xl);
    }

    .nav-section-title {
      font-size: var(--font-size-xs);
      font-weight: var(--font-weight-semibold);
      color: var(--color-text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: var(--space-sm);
    }

    .nav-items {
      display: flex;
      flex-direction: column;
      gap: var(--space-xs);
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      padding: var(--space-sm) var(--space-md);
      border-radius: var(--radius-md);
      color: var(--color-text-secondary);
      text-decoration: none;
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-medium);
      transition: all var(--transition-normal);
      cursor: pointer;
    }

    .nav-item:hover {
      background: rgba(118, 150, 86, 0.1);
      color: var(--color-accent-primary);
    }

    .nav-item.active {
      background: rgba(118, 150, 86, 0.15);
      color: var(--color-accent-primary);
      border: 1px solid rgba(118, 150, 86, 0.2);
    }

    .nav-icon {
      font-size: var(--font-size-lg);
      width: 20px;
      text-align: center;
    }

    /* User Profile in Sidebar */
    .sidebar-footer {
      padding: var(--space-lg);
      border-top: 1px solid var(--glass-border);
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      padding: var(--space-md);
      border-radius: var(--radius-lg);
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.05);
      cursor: pointer;
      transition: all var(--transition-normal);
    }

    .user-profile:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      background: linear-gradient(135deg, var(--color-accent-primary) 0%, var(--color-accent-light) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-text-inverse);
      font-weight: var(--font-weight-bold);
      font-size: var(--font-size-lg);
    }

    .user-info {
      flex: 1;
      min-width: 0;
    }

    .user-name {
      font-weight: var(--font-weight-semibold);
      font-size: var(--font-size-sm);
      color: var(--color-text-primary);
      margin-bottom: var(--space-xs);
    }

    .user-rating {
      font-size: var(--font-size-xs);
      color: var(--color-text-muted);
    }

    .rating-badge {
      background: rgba(118, 150, 86, 0.2);
      color: var(--color-accent-primary);
      padding: 2px var(--space-xs);
      border-radius: var(--radius-sm);
      font-weight: var(--font-weight-medium);
    }

    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: var(--sidebar-width);
      background: var(--color-bg-primary);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    .header {
      background: var(--glass-bg);
      backdrop-filter: blur(16px);
      border-bottom: 1px solid var(--glass-border);
      padding: var(--space-lg) var(--space-xl);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .header-title {
      font-size: var(--font-size-xl);
      font-weight: var(--font-weight-bold);
      color: var(--color-text-primary);
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: var(--space-md);
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: var(--space-xs);
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      background: var(--color-success);
      border-radius: var(--radius-full);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Content Area */
    .content {
      flex: 1;
      display: grid;
      grid-template-columns: 1fr 350px;
      gap: var(--space-xl);
      padding: var(--space-xl);
      max-width: 1400px;
      margin: 0 auto;
      width: 100%;
    }

    .content-main {
      display: flex;
      flex-direction: column;
      gap: var(--space-xl);
    }

    .content-sidebar {
      display: flex;
      flex-direction: column;
      gap: var(--space-xl);
    }

    /* Glass Card Component */
    .glass-card {
      background: var(--glass-bg);
      backdrop-filter: blur(16px);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-xl);
      padding: var(--space-xl);
      box-shadow: var(--shadow-lg);
    }

    /* Section Titles */
    .section-title {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-semibold);
      color: var(--color-text-primary);
      margin-bottom: var(--space-lg);
    }

    .section-icon {
      font-size: var(--font-size-xl);
    }

    /* Quick Actions */
    .action-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--space-lg);
    }

    .action-card {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      text-align: center;
      cursor: pointer;
      transition: all var(--transition-normal);
      position: relative;
      overflow: hidden;
    }

    .action-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--color-accent-primary), transparent);
      opacity: 0;
      transition: opacity var(--transition-normal);
    }

    .action-card:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(118, 150, 86, 0.3);
      transform: translateY(-2px);
      box-shadow: var(--shadow-xl);
    }

    .action-card:hover::before {
      opacity: 1;
    }

    .action-card:active {
      transform: translateY(0);
    }

    .action-icon {
      font-size: 48px;
      display: block;
      margin-bottom: var(--space-md);
      opacity: 0.8;
    }

    .action-title {
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-semibold);
      color: var(--color-text-primary);
      margin-bottom: var(--space-sm);
    }

    .action-description {
      font-size: var(--font-size-sm);
      color: var(--color-text-muted);
      line-height: 1.5;
    }

    /* Specialized Action Cards */
    .action-card.quick-play .action-icon { color: var(--color-accent-primary); }
    .action-card.create-game .action-icon { color: #3b82f6; }
    .action-card.join-game .action-icon { color: #f59e0b; }
    .action-card.puzzles .action-icon { color: #8b5cf6; }

    /* Games Section */
    .games-list {
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
    }

    .game-card {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      cursor: pointer;
      transition: all var(--transition-normal);
    }

    .game-card:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(118, 150, 86, 0.3);
      transform: translateY(-1px);
    }

    .game-players {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--space-md);
    }

    .player-info {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .player-avatar {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: linear-gradient(135deg, var(--color-accent-primary) 0%, var(--color-accent-light) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-text-inverse);
      font-weight: var(--font-weight-bold);
      font-size: var(--font-size-sm);
    }

    .player-name {
      font-weight: var(--font-weight-medium);
      color: var(--color-text-primary);
      font-size: var(--font-size-sm);
    }

    .player-rating {
      font-size: var(--font-size-xs);
      color: var(--color-text-muted);
    }

    .vs-divider {
      font-size: var(--font-size-sm);
      color: var(--color-text-muted);
      font-weight: var(--font-weight-medium);
    }

    .game-status {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .status-badge {
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-full);
      font-size: var(--font-size-xs);
      font-weight: var(--font-weight-medium);
      text-transform: uppercase;
    }

    .status-waiting {
      background: rgba(251, 191, 36, 0.2);
      color: var(--color-warning);
    }

    .status-active {
      background: rgba(34, 197, 94, 0.2);
      color: var(--color-success);
    }

    .status-finished {
      background: rgba(107, 114, 128, 0.2);
      color: var(--color-text-muted);
    }

    .game-time {
      font-size: var(--font-size-xs);
      color: var(--color-text-muted);
    }

    /* Stats Panel */
    .stats-panel {
      background: var(--glass-bg);
      backdrop-filter: blur(16px);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-xl);
      padding: var(--space-xl);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-lg);
    }

    .stat-item {
      text-align: center;
      padding: var(--space-md);
      background: rgba(255, 255, 255, 0.02);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .stat-value {
      font-size: var(--font-size-xl);
      font-weight: var(--font-weight-bold);
      color: var(--color-accent-primary);
      margin-bottom: var(--space-xs);
    }

    .stat-label {
      font-size: var(--font-size-xs);
      color: var(--color-text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Online Players */
    .online-players {
      background: var(--glass-bg);
      backdrop-filter: blur(16px);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-xl);
      padding: var(--space-xl);
    }

    .players-list {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
      max-height: 300px;
      overflow-y: auto;
    }

    .player-item {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      padding: var(--space-sm);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .player-item:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .player-status {
      width: 8px;
      height: 8px;
      background: var(--color-success);
      border-radius: var(--radius-full);
      flex-shrink: 0;
    }

    .player-item .player-avatar {
      width: 28px;
      height: 28px;
      font-size: var(--font-size-xs);
    }

    .player-item .player-info {
      flex: 1;
      min-width: 0;
    }

    .player-item .player-name {
      font-size: var(--font-size-xs);
      margin-bottom: 2px;
    }

    .player-item .player-rating {
      font-size: var(--font-size-xs);
    }

    /* Empty States */
    .empty-state {
      text-align: center;
      padding: var(--space-xl);
      color: var(--color-text-muted);
    }

    .empty-icon {
      font-size: 48px;
      margin-bottom: var(--space-md);
      opacity: 0.5;
    }

    .empty-title {
      font-size: var(--font-size-md);
      font-weight: var(--font-weight-medium);
      margin-bottom: var(--space-sm);
    }

    .empty-description {
      font-size: var(--font-size-sm);
      line-height: 1.5;
    }

    /* Loading Skeletons */
    .loading-skeleton {
      height: 80px;
      background: rgba(255, 255, 255, 0.02);
      border-radius: var(--radius-lg);
      margin-bottom: var(--space-md);
      position: relative;
      overflow: hidden;
    }

    .loading-skeleton::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
      0% { left: -100%; }
      100% { left: 100%; }
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
      .content {
        grid-template-columns: 1fr;
        gap: var(--space-lg);
      }
      
      .content-sidebar {
        order: -1;
      }
      
      .stats-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        transition: transform var(--transition-normal);
      }
      
      .sidebar.open {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 0;
      }
      
      .content {
        padding: var(--space-md);
      }
      
      .action-grid {
        grid-template-columns: 1fr;
      }
      
      .stats-grid {
        grid-template-columns: 1fr 1fr;
      }
      
      .header {
        padding: var(--space-md);
      }
      
      .glass-card {
        padding: var(--space-lg);
      }
    }

    /* CSS Variables (add these to global.css if not present) */
    :root {
      --sidebar-width: 280px;
      --glass-bg: rgba(255, 255, 255, 0.03);
      --glass-border: rgba(255, 255, 255, 0.08);
      --transition-fast: 0.15s ease;
      --transition-normal: 0.2s ease;
      --radius-full: 9999px;
      --radius-xl: 16px;
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
    }

    /* Professional Lobby Layout */
    .lobby-container {
      min-height: 100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
    }

    /* Sidebar Navigation */
    .sidebar {
      width: var(--sidebar-width);
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      border-right: 1px solid var(--glass-border);
      padding: 2rem 1.5rem;
      display: flex;
      flex-direction: column;
    }

    .sidebar-header h2 {
      color: white;
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 2rem;
      text-align: center;
    }

    .nav-menu {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .nav-item {
      padding: 0.75rem 1rem;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      border-radius: 12px;
      transition: var(--transition-normal);
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .nav-item:hover,
    .nav-item.active {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      transform: translateX(4px);
    }

    .user-profile {
      margin-top: auto;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      text-align: center;
    }

    .user-profile img {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      margin-bottom: 0.5rem;
    }

    /* Main Content Area */
    .main-content {
      flex: 1;
      padding: 2rem;
      overflow-y: auto;
    }

    .content-header {
      margin-bottom: 2rem;
    }

    .content-header h1 {
      color: white;
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .content-header p {
      color: rgba(255, 255, 255, 0.7);
      font-size: 1.1rem;
    }

    /* Quick Actions Grid */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .action-card {
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      padding: 1.5rem;
      border-radius: var(--radius-xl);
      text-align: center;
      transition: var(--transition-normal);
      cursor: pointer;
    }

    .action-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-xl);
      background: rgba(255, 255, 255, 0.08);
    }

    .action-card .icon {
      font-size: 2rem;
      margin-bottom: 1rem;
      display: block;
    }

    .action-card h3 {
      color: white;
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .action-card p {
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.9rem;
    }

    /* Games Section */
    .games-section {
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-xl);
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .section-header h2 {
      color: white;
      font-size: 1.3rem;
      font-weight: 600;
    }

    .view-all-btn {
      color: #60a5fa;
      text-decoration: none;
      font-weight: 500;
      transition: var(--transition-fast);
    }

    .view-all-btn:hover {
      color: #93c5fd;
    }

    .games-grid {
      display: grid;
      gap: 1rem;
    }

    .game-item {
      background: rgba(255, 255, 255, 0.03);
      padding: 1rem;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      transition: var(--transition-normal);
    }

    .game-item:hover {
      background: rgba(255, 255, 255, 0.06);
      transform: translateX(4px);
    }

    .game-players {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.75rem;
    }

    .player-info {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .player-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea, #764ba2);
    }

    .player-name {
      color: white;
      font-weight: 500;
    }

    .player-rating {
      color: rgba(255, 255, 255, 0.6);
      font-size: 0.9rem;
    }

    .game-status {
      color: #10b981;
      font-size: 0.9rem;
      font-weight: 500;
    }

    /* Statistics Panel */
    .stats-panel {
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-xl);
      padding: 1.5rem;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }

    .stat-item {
      text-align: center;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 12px;
    }

    .stat-value {
      color: white;
      font-size: 1.5rem;
      font-weight: 700;
      display: block;
    }

    .stat-label {
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.9rem;
      margin-top: 0.25rem;
    }

    /* Loading States */
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 2rem;
      color: rgba(255, 255, 255, 0.7);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .lobby-container {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
        padding: 1rem;
      }
      
      .nav-menu {
        flex-direction: row;
        overflow-x: auto;
      }
      
      .main-content {
        padding: 1rem;
      }
      
      .quick-actions {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
      animation: fadeIn 0.3s ease;
    }
  </style>
</head>

<body>
  <div class="lobby-container">
    <!-- Sidebar Navigation -->
    <nav class="sidebar">
      <div class="sidebar-header">
        <h2>‚ôî ChessHub</h2>
      </div>
      
      <div class="nav-menu">
        <a href="#" class="nav-item active">
          <span>üè†</span> Dashboard
        </a>
        <a href="#" class="nav-item" onclick="startQuickGame()">
          <span>‚ö°</span> Quick Game
        </a>
        <a href="#" class="nav-item">
          <span>üèÜ</span> Tournaments
        </a>
        <a href="#" class="nav-item">
          <span>üß©</span> Puzzles
        </a>
        <a href="#" class="nav-item">
          <span>üìä</span> Analysis
        </a>
        <a href="#" class="nav-item">
          <span>üë•</span> Friends
        </a>
        <a href="#" class="nav-item">
          <span>‚öôÔ∏è</span> Settings
        </a>
      </div>
      
      <div class="user-profile">
        <img src="https://via.placeholder.com/48/667eea/ffffff?text=U" alt="User Avatar" id="userAvatar">
        <div class="user-info">
          <div style="color: white; font-weight: 600;" id="userName">Loading...</div>
          <div style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">Rating: <span id="userRating">1200</span></div>
        </div>
        <button onclick="logout()" style="margin-top: 0.5rem; padding: 0.5rem 1rem; background: rgba(255, 255, 255, 0.1); border: none; border-radius: 8px; color: white; cursor: pointer;">Logout</button>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Content Header -->
      <div class="content-header">
        <h1>Welcome back!</h1>
        <p>Ready for your next chess adventure?</p>
      </div>

      <!-- Quick Actions -->
      <div class="quick-actions">
        <div class="action-card" onclick="startQuickGame()">
          <span class="icon">‚ö°</span>
          <h3>Quick Game</h3>
          <p>Start playing instantly</p>
        </div>
        
        <div class="action-card" onclick="createCustomGame()">
          <span class="icon">üéØ</span>
          <h3>Custom Game</h3>
          <p>Set your own rules</p>
        </div>
        
        <div class="action-card" onclick="solvePuzzles()">
          <span class="icon">üß©</span>
          <h3>Daily Puzzle</h3>
          <p>Sharpen your skills</p>
        </div>
        
        <div class="action-card" onclick="joinTournament()">
          <span class="icon">üèÜ</span>
          <h3>Tournament</h3>
          <p>Compete with others</p>
        </div>
      </div>

      <!-- Active Games Section -->
      <div class="games-section">
        <div class="section-header">
          <h2>Recent Games</h2>
          <a href="#" class="view-all-btn">View All</a>
        </div>
        
        <div class="games-grid" id="gamesContainer">
          <div class="loading">Loading your games...</div>
        </div>
      </div>

      <!-- Statistics Panel -->
      <div class="stats-panel">
        <div class="section-header">
          <h2>Your Stats</h2>
        </div>
        
        <div class="stats-grid">
          <div class="stat-item">
            <span class="stat-value" id="totalGames">0</span>
            <div class="stat-label">Games Played</div>
          </div>
          
          <div class="stat-item">
            <span class="stat-value" id="winRate">0%</span>
            <div class="stat-label">Win Rate</div>
          </div>
          
          <div class="stat-item">
            <span class="stat-value" id="currentStreak">0</span>
            <div class="stat-label">Current Streak</div>
          </div>
          
          <div class="stat-item">
            <span class="stat-value" id="puzzlesSolved">0</span>
            <div class="stat-label">Puzzles Solved</div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Initialize the lobby
    window.lobbyAPI = new ChessAPI();
    
    // Load user data and games on page load
    document.addEventListener('DOMContentLoaded', async function() {
      await loadUserData();
      await loadRecentGames();
      await loadUserStats();
    });

    // Load user profile data
    async function loadUserData() {
      try {
        const result = await lobbyAPI.getUserProfile();
        if (result.ok) {
          document.getElementById('userName').textContent = result.data.username;
          document.getElementById('userRating').textContent = result.data.rating || 1200;
        }
      } catch (error) {
        console.error('Error loading user data:', error);
        lobbyAPI.showError('Failed to load user profile');
      }
    }

    // Load recent games
    async function loadRecentGames() {
      try {
        const result = await lobbyAPI.getGames();
        const container = document.getElementById('gamesContainer');
        
        if (result.ok && result.data.length > 0) {
          container.innerHTML = result.data.slice(0, 5).map(game => `
            <div class="game-item fade-in">
              <div class="game-players">
                <div class="player-info">
                  <div class="player-avatar"></div>
                  <div>
                    <div class="player-name">${game.white_player?.username || 'Anonymous'}</div>
                    <div class="player-rating">(${game.white_player?.rating || 1200})</div>
                  </div>
                </div>
                <div style="color: rgba(255, 255, 255, 0.5);">vs</div>
                <div class="player-info">
                  <div class="player-avatar"></div>
                  <div>
                    <div class="player-name">${game.black_player?.username || 'Anonymous'}</div>
                    <div class="player-rating">(${game.black_player?.rating || 1200})</div>
                  </div>
                </div>
              </div>
              <div class="game-status">${formatGameStatus(game.status)}</div>
            </div>
          `).join('');
        } else {
          container.innerHTML = '<div style="color: rgba(255, 255, 255, 0.7); text-align: center; padding: 2rem;">No recent games found. Start your first game!</div>';
        }
      } catch (error) {
        console.error('Error loading games:', error);
        document.getElementById('gamesContainer').innerHTML = '<div style="color: #ef4444; text-align: center; padding: 2rem;">Failed to load games</div>';
      }
    }

    // Load user statistics
    async function loadUserStats() {
      try {
        // Mock data for now - replace with actual API calls
        document.getElementById('totalGames').textContent = Math.floor(Math.random() * 100);
        document.getElementById('winRate').textContent = (50 + Math.floor(Math.random() * 30)) + '%';
        document.getElementById('currentStreak').textContent = Math.floor(Math.random() * 10);
        document.getElementById('puzzlesSolved').textContent = Math.floor(Math.random() * 50);
      } catch (error) {
        console.error('Error loading stats:', error);
      }
    }

    // Game action functions
    async function startQuickGame() {
      lobbyAPI.showToast('Looking for opponent...', 'info');
      // Implement quick game logic
      setTimeout(() => {
        lobbyAPI.showSuccess('Opponent found! Starting game...');
      }, 2000);
    }

    function createCustomGame() {
      lobbyAPI.showToast('Custom game creator coming soon!', 'info');
    }

    function solvePuzzles() {
      lobbyAPI.showToast('Puzzle mode coming soon!', 'info');
    }

    function joinTournament() {
      lobbyAPI.showToast('Tournament system coming soon!', 'info');
    }

    // Utility functions
    function formatGameStatus(status) {
      const statusMap = {
        'active': 'üîµ In Progress',
        'completed': '‚úÖ Completed',
        'waiting': '‚è≥ Waiting for opponent'
      };
      return statusMap[status] || '‚ùì Unknown';
    }

    // Logout function
    async function logout() {
      try {
        await lobbyAPI.logout();
        lobbyAPI.showSuccess('Logged out successfully');
        setTimeout(() => {
          window.router?.navigate('/auth/login');
        }, 1000);
      } catch (error) {
        console.error('Logout error:', error);
        lobbyAPI.showError('Failed to logout properly');
        // Force logout anyway
        window.router?.navigate('/auth/login');
      }
    }
  </script>
</body>
</html>